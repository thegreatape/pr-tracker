#!/usr/bin/env ruby

lib = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require 'pr_finder'
require 'parser'
require 'exercise'
require 'date'
require 'active_support/all'

workouts = Dir.glob("#{ARGV[0]}/**/*.workout").map do |file_path|
  $stderr.puts file_path
  year, month, day = file_path.split('/').last(3).map(&:to_i)
  Parser.new.parse(File.read(file_path), Date.new(year, month, day))
end

puts "window.prData = #{PRFinder.new(workouts).prs_as_chart_data.to_json}"
